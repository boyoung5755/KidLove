<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.KidLove.auth.dao.AuthDAO">

	<select id="findMberNo" parameterType="String">
		SELECT	
			M.MBER_NO 
		FROM mber M
		WHERE MBER_ID = #{mberId}
	</select>
	
	<insert id="setMberAuthor" parameterType="map">
		INSERT INTO author
			(
				MBER_NO
				, AUTHOR_NM
			)
		VALUES
			(
				#{mberNo}
				,#{authorNm}
			)
	</insert>


	<insert  id="joinSSO" parameterType = "com.KidLove.mber.vo.MberVO">
		INSERT INTO mber
			(
				MBER_ID
				, ATCH_CODE
				, CNRS_CD
				, CRT_DT
				, MBER_LAST_CONECTDT
				, MBER_LOGIN_TY
			)
		VALUES
			(
				#{mberId}
				, #{atchCode}
				, #{cnrsCd}
				, CURRENT_TIMESTAMP
				, CURRENT_TIMESTAMP
				, #{mberLoginTy}
			)
	</insert>	
	
	
	<select id="loginWithKakao" parameterType= "String" >
		SELECT	
			M.MBER_ID 
		FROM mber M 
		WHERE M.MBER_ID = #{loginId}
		AND M.MBER_LOGIN_TY ="KAKAO"
	</select>
	
	<select id="loginWithGoogle" parameterType= "String" >
		SELECT	
			M.MBER_ID 
		FROM mber M 
		WHERE M.MBER_ID = #{loginId}
		AND M.MBER_LOGIN_TY ="GOOGLE"
	</select>
	
	<insert  id="join" parameterType = "com.KidLove.mber.vo.MberVO">
		INSERT INTO mber
			(
				MBER_ID
				, MBER_PW
				, MBER_NCNM
				, MBER_EML
				, MBER_TEL
				, MBER_ADDR
				, MBER_ZIP
				, MBER_STTUS
				, MBER_SEXDSTN
				, ATCH_CODE
				, CNRS_CD
				, CRT_DT
				, MBER_LAST_CONECTDT
				, MBER_LOGIN_TY
			)
		VALUES
			(
				#{mberId}
				, #{mberPw}
				, #{mberNcnm}
				, #{mberEml}
				, #{mberTel}
				, #{mberAddr}
				, #{mberZip}
				, #{mberSttus}
				, #{mberSexdstn}
				, #{atchCode}
				, #{cnrsCd}
				, CURRENT_TIMESTAMP
				, CURRENT_TIMESTAMP
				, #{mberLoginTy}
			)
	</insert>	

	<select id="findOneWithAuthoritiesByUserId"  parameterType="String">
		SELECT 
			A.AUTHOR_NM AS mberRole
			, M.*
		FROM mber M
		LEFT OUTER JOIN author A
		ON M.MBER_NO = A.MBER_NO 
		WHERE MBER_ID= #{mberId}
	</select>
	
	<update  id="saveToken" parameterType="com.KidLove.mber.vo.MberVO">
		UPDATE mber
		SET  
			REFRESH_TOKEN=#{refreshToken}
		WHERE MBER_ID=#{mberId}
	</update>
	
	<select id="findByKey"  parameterType="String">
		SELECT M.REFRESH_TOKEN 
		FROM mber M 
		WHERE  MBER_ID =#{mberId}
	</select>
	
</mapper>